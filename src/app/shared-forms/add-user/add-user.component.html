<div class="card flex justify-center mt-4">
    <p-selectbutton size="large" styleClass="w-full" [options]="stateOptions" [(ngModel)]="selectedState" optionLabel="label" optionValue="value" aria-labelledby="basic" (onChange)="onStateChange()"/>
</div>
<div *ngIf="selectedState === 'import'">
    <p class="text-center mt-4">Please upload a file in the format of .xls or .xlsx</p>
    <div class="flex justify-center">
        <div class="mt-4 w-[360px] p-3 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-sm font-semibold text-blue-800 mb-2">Required Excel Columns:</p>
            <p class="text-xs text-blue-700">
                <strong>Required:</strong> ucIdNumber, firstName, lastName, email, phoneNumber, sex, userRoles (comma-separated), maritalStatus, dateOfBirth<br>
                <strong>Optional:</strong> middleName, extName
            </p>
            <p class="text-xs text-blue-600 mt-1 mt-4">
                <em>Note: Passwords will be auto-generated (8 characters) and users will be set to first login.</em>
            </p>
        </div>
    </div>

    <div class="flex justify-center mt-4">
        <p-button (click)="downloadExcelTemplate()" label="Download Excel Template" icon="pi pi-download" link ></p-button>
    </div>
    
    <div class="mt-6">
        <p-fileupload mode="basic" name="demo[]" chooseIcon="pi pi-upload" 
        accept=".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
        maxFileSize="10000000" (onSelect)="onBasicUploadAuto($event)" 
        chooseLabel="Upload Excel File" [disabled]="isProcessing" />
    </div>
    
    <div *ngIf="isProcessing" class="mt-4">
        <div class="text-center mb-2">
            <p class="font-semibold">{{processingStatus}}</p>
        </div>
        <p-progressbar [value]="processingProgress" [showValue]="true"></p-progressbar>
    </div>
    
    <div *ngIf="!isProcessing && processingProgress === 100" class="mt-4 text-center">
        <p class="text-green-600 font-semibold">âœ“ Import completed successfully!</p>
        <p class="text-xs text-gray-600 mt-2">
            Excel file with user details has been automatically downloaded.
        </p>
    </div>
</div>
<div *ngIf="selectedState === 'manual'">
    <div class="mt-4">
        <form [formGroup]="addUserForm">
            <p-floatlabel variant="on" class="mt-4">
                <p-inputnumber formControlName="ucIdNumber" mode="decimal" inputId="withoutgrouping" [useGrouping]="false" fluid/>
                <label for="idNumber">UC ID Number</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('ucIdNumber')?.invalid && addUserForm.get('ucIdNumber')?.touched" class="text-red-500 text-sm mt-1">
                UC ID Number is required
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <input pInputText id="firstName" formControlName="firstName" autocomplete="off" fluid />
                <label for="firstName">First Name</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('firstName')?.invalid && addUserForm.get('firstName')?.touched" class="text-red-500 text-sm mt-1">
                First Name is required
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <input pInputText id="middleName" formControlName="middleName" autocomplete="off" fluid />
                <label for="middleName">Middle Name</label>
            </p-floatlabel>
            <p-floatlabel variant="on" class="mt-4">
                <input pInputText id="lastName" formControlName="lastName" autocomplete="off" fluid />
                <label for="lastName">Last Name</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('lastName')?.invalid && addUserForm.get('lastName')?.touched" class="text-red-500 text-sm mt-1">
                Last Name is required
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <p-select formControlName="extName" inputId="extName" [options]="extNameOptions" optionLabel="name" appendTo="body" fluid />
                <label for="extName">Extension Name</label>
            </p-floatlabel>
            <p-floatlabel variant="on" class="mt-4">
                <p-select formControlName="sex" inputId="sex" [options]="sexOptions" optionLabel="name" appendTo="body" fluid />
                <label for="sex">Sex</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('sex')?.invalid && addUserForm.get('sex')?.touched" class="text-red-500 text-sm mt-1">
                Sex is required
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <input pInputText id="email" formControlName="email" autocomplete="off" appendTo="body" fluid />
                <label for="email">Email</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('email')?.value === '' && addUserForm.get('email')?.touched" class="text-red-500 text-sm mt-1">
                Email is required
            </div>
            <div *ngIf="addUserForm.get('email')?.errors?.['email'] && addUserForm.get('email')?.touched" class="text-red-500 text-sm mt-1">
                Please enter a valid email address
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <input pInputText id="phoneNumber" formControlName="phoneNumber" autocomplete="off" fluid />
                <label for="phoneNumber">Phone Number</label>
            </p-floatlabel>
            <p-floatlabel variant="on" class="mt-4">
                <p-datepicker formControlName="dateOfBirth" inputId="dateOfBirth" showIcon iconDisplay="input" appendTo="body" fluid />
                <label for="dateOfBirth">Date of Birth</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('dateOfBirth')?.invalid && addUserForm.get('dateOfBirth')?.touched" class="text-red-500 text-sm mt-1">
                Date of Birth is required
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <p-select formControlName="maritalStatus" inputId="maritalStatus" [options]="maritalStatusOptions" optionLabel="name" appendTo="body" fluid />
                <label for="maritalStatus">Marital Status</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('maritalStatus')?.invalid && addUserForm.get('maritalStatus')?.touched" class="text-red-500 text-sm mt-1">
                Marital Status is required
            </div>
            <p-floatlabel variant="on" class="mt-4">
                <p-multiselect formControlName="userRoles" [options]="userRoleOptions" inputId="userRoles" optionLabel="name" display="chip" appendTo="body" fluid/>
                <label for="userRoles">User Roles</label>
            </p-floatlabel>
            <div *ngIf="addUserForm.get('userRoles')?.invalid && addUserForm.get('userRoles')?.touched" class="text-red-500 text-sm mt-1">
                User Roles is required
            </div>
            <div class="mt-4">
                <p-button (click)="onAddUser()" label="Add User" icon="fa-solid fa-user-plus" [disabled]="addUserForm.invalid || isLoading()" fluid/>
            </div>

        </form>
    </div>
    
</div>